#!/usr/bin/env bpython -i
import getpass
import logging
import os
import sys

import chatexchange


logging.basicConfig(level=logging.WARNING)

sys.stderr.write("chatexchange == %r\n" % (chatexchange))

host = 'stackexchange.com'
sys.stderr.write("host == %r\n" % (host))

if 'ChatExchangeU' in os.environ:
    email = os.environ['ChatExchangeU']
    if email:
        sys.stderr.write("# using email from $ChatExchangeU\n")
else:
    sys.stderr.write("# email (optional): ")
    sys.stderr.flush()
    email = sys.stdin.readline()[:-1]

if email:
    if 'ChatExchangeP' in os.environ:
        password = os.environ['ChatExchangeP']
        sys.stderr.write("# using password from $ChatExchangeP\n")
    else:
        password = getpass.getpass("# password: ")
else:
    sys.stderr.write("# continuing without authentication\n")

if email:
    chat = chatexchange.Client(host, email, password)
else:
    chat = chatexchange.Client(host)
sys.stderr.write("chat == %r\n" % (chat))

sandbox = chat.get_room(1)
sys.stderr.write("sandbox == %r\n" % (sandbox))

if email:
    somebody = chat.get_me()
else:
    somebody = chat.get_user(-2)

sys.stderr.write("somebody == %r\n" % (somebody))
sys.stderr.write("somebody.name == %r\n" % (somebody.name))

greeting = chat.get_message(15356352)

sys.stderr.write("greeting == %r\n" % (greeting))
sys.stderr.write("greeting.text_content == %r\n" % (greeting.text_content))

sys.stderr.write("\n")
